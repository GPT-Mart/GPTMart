<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GPTMart — Curated Custom GPTs</title>
  <meta name="description" content="A lightning‑fast, keyboard‑driven directory of my best Custom GPTs. Search, filter, feature, and manage — all in one file." />
  <meta name="theme-color" content="#0b0f19" />
  <meta name="color-scheme" content="dark" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta property="og:title" content="GPTMart — Curated Custom GPTs" />
  <meta property="og:description" content="A lightning‑fast, keyboard‑driven directory of my best Custom GPTs." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/9919?s=200&v=4" />

  <!-- Analytics (kept, with settings override) -->
  <script>
    window.GA_MEASUREMENT_ID = window.GA_MEASUREMENT_ID || 'G-ZNB7MWLE99';
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
  </script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZNB7MWLE99"></script>
  <script> gtag('js', new Date()); gtag('config', window.GA_MEASUREMENT_ID); </script>

  <style>
    :root{
      --bg:#050815; --bg-2:#080e1f; --bg-3:#0b142a;
      --card:#0c1327; --card-2:#0e162f; --panel:#0b1a36;
      --text:#e6ecff; --muted:#a9b4c7; --accent:#6ea8ff; --accent-2:#3b82f6;
      --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444;
      --stroke:#16213a; --glow:0 0 0 2px rgba(110,168,255,.15), 0 30px 120px -40px rgba(60,120,255,.35);
      --radius:14px; --radius-lg:18px; --shadow:0 10px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:radial-gradient(1200px 600px at 80% -10%,#12244c22 0,#0000 70%), linear-gradient(180deg,var(--bg),#091229 60%, #0a1333 100%); color:var(--text);}
    a{color:inherit}
    .container{width:95%;max-width:1200px;margin:0 auto}
    .visually-hidden{position:absolute!important;clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden;}

    /* Topbar */
    .topbar{position:sticky;top:0;z-index:50;background:rgba(5,8,21,.65);backdrop-filter:blur(10px);border-bottom:1px solid var(--stroke)}
    .top-row{display:flex;align-items:center;gap:12px;justify-content:space-between;padding:12px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px}
    .brand svg{filter:drop-shadow(0 4px 18px rgba(110,168,255,.45))}
    .nav{display:flex;gap:8px}
    .chip{border:1px solid var(--stroke);background:linear-gradient(180deg,#0b1327,#091226);padding:8px 12px;border-radius:999px;color:#cbd5e1;text-decoration:none}
    .chip.active{background:linear-gradient(180deg,#1b2a55,#13224b);border-color:#21408b;box-shadow:var(--glow)}
    .btn{background:linear-gradient(180deg,#1b2a55,#142447);border:1px solid #1a2b5a;padding:10px 14px;border-radius:12px;color:#e7efff;text-decoration:none;font-weight:700;display:inline-flex;align-items:center;gap:8px;box-shadow:0 6px 24px rgba(0,0,0,.25)}
    .btn:hover{border-color:#264890}
    .btn.accent{background:linear-gradient(180deg,#2c57c7,#2549a8);border-color:#2e53b7;box-shadow:0 6px 28px rgba(59,130,246,.35)}

    /* Sections */
    .section{padding:30px 0}

    /* Hero */
    .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:24px;align-items:end}
    @media (max-width:900px){.hero{grid-template-columns:1fr}}
    .hero h1{margin:0;font-size:clamp(30px,4vw,44px);line-height:1.05}
    .hero p{color:var(--muted);margin:.4rem 0 0}
    .hero-card{background:linear-gradient(180deg,#0e1733,#0b1228);border:1px solid var(--stroke);border-radius:var(--radius-lg);padding:16px;box-shadow:var(--shadow)}
    .quick{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .quick .k{border:1px dashed #27407a;color:#bcd2ff;padding:6px 10px;border-radius:999px;font-size:12px}

    /* Search ribbon */
    .ribbon{margin-top:10px;display:grid;grid-template-columns:1fr 200px 200px auto;gap:8px}
    @media (max-width:900px){.ribbon{grid-template-columns:1fr 1fr}}
    .input{border:1px solid var(--stroke);background:linear-gradient(180deg,#091327,#071022);border-radius:12px;padding:12px 14px;color:var(--text)}
    .input::placeholder{color:#8aa0c2}

    /* Languages strip */
    .langs{display:flex;flex-wrap:wrap;gap:14px;align-items:center;margin:16px 0}
    .lang{display:grid;justify-items:center;gap:6px;text-decoration:none}
    .lang img{width:44px;height:44px;border-radius:10px;background:#0a1324;border:1px solid var(--stroke);padding:8px;transition:transform .15s}
    .lang:hover img{transform:translateY(-2px) scale(1.05)}
    .lang span{font-size:12px;color:#cbd5e1}

    /* Grid */
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px;margin-top:16px}
    .col{grid-column:span 3}
    @media (max-width:1100px){.col{grid-column:span 4}}
    @media (max-width:800px){.col{grid-column:span 6}}
    @media (max-width:560px){.col{grid-column:span 12}}
    .card{background:linear-gradient(180deg,var(--card),var(--card-2));border:1px solid var(--stroke);border-radius:var(--radius);padding:14px;display:flex;flex-direction:column;gap:10px;box-shadow:var(--shadow);position:relative}
    .card:hover{box-shadow:0 20px 80px rgba(60,120,255,.15)}
    .icon{width:48px;height:48px;border-radius:10px;overflow:hidden;border:1px solid #1f2937;background:#0a1324}
    .icon img{width:100%;height:100%;object-fit:cover}
    .title{font-weight:800;margin:0}
    .desc{color:#a7b0c0;font-size:14px;line-height:1.5}
    .tags{display:flex;gap:6px;flex-wrap:wrap}
    .tag{font-size:11px;border:1px dashed #2c3850;padding:4px 8px;border-radius:999px;color:#c7d2fe}
    .badge{position:absolute;top:10px;right:10px;font-size:11px;background:#1a2c5c;border:1px solid #254a9b;color:#d5e4ff;border-radius:999px;padding:4px 8px}
    .actions{margin-top:auto;display:flex;gap:8px}

    /* Panels & table */
    .panel{background:linear-gradient(180deg,#0e1733,#0b1228);border:1px solid var(--stroke);border-radius:14px;padding:16px}
    .row{display:flex;gap:10px;align-items:center}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{text-align:left;font-size:14px}
    tbody tr{background:#0b1426}
    tbody td{padding:10px;border-top:1px solid var(--stroke);border-bottom:1px solid var(--stroke)}
    tbody tr td:first-child{border-left:1px solid var(--stroke);border-top-left-radius:10px;border-bottom-left-radius:10px}
    tbody tr td:last-child{border-right:1px solid var(--stroke);border-top-right-radius:10px;border-bottom-right-radius:10px}

    footer{color:#94a3b8;border-top:1px solid var(--stroke);padding:18px 0;margin-top:30px;text-align:center}

    /* Command palette */
    .palette{position:fixed;inset:0;display:none;place-items:center;background:rgba(5,8,21,.6);backdrop-filter:blur(6px);z-index:80}
    .palette.open{display:grid}
    .pal-card{width:min(840px,92vw);background:linear-gradient(180deg,#0d1634,#0b1228);border:1px solid #20305a;border-radius:16px;box-shadow:var(--shadow)}
    .pal-head{padding:10px;border-bottom:1px solid #1b2a52}
    .pal-head input{width:100%;background:#0b1228;border:1px solid #1a2b56;color:#e7efff;border-radius:10px;padding:12px}
    .pal-list{max-height:60vh;overflow:auto}
    .pal-item{display:flex;justify-content:space-between;gap:10px;padding:12px 14px;border-bottom:1px solid #11204a;cursor:pointer}
    .pal-item:hover{background:#0f1a3a}

    /* Hide helpers */
    .hide{display:none!important}
  </style>
</head>
<body>
  <a class="visually-hidden" href="#content">Skip to content</a>

  <header class="topbar" role="navigation" aria-label="Top">
    <div class="container top-row">
      <div class="brand">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2l2.39 7.36h7.73l-6.25 4.54 2.39 7.36L12 16.72 5.74 21.9l2.39-7.36L1.88 9.36h7.73L12 2z" fill="url(#g)"/><defs><linearGradient id="g" x1="0" x2="1" y1="0" y2="1"><stop stop-color="#6ea8ff"/><stop offset="1" stop-color="#3b82f6"/></linearGradient></defs></svg>
        <span id="siteLogo">GPTMart</span>
      </div>
      <nav class="nav" aria-label="Views">
        <a class="chip" id="navExplore" href="#/explore">Explore</a>
        <a class="chip" id="navAdmin" href="#/admin">Admin</a>
      </nav>
      <div class="nav">
        <button class="chip" id="openPalette" title="Command palette (⌘/Ctrl K)">⌘K</button>
        <a class="btn accent" href="#/explore">Browse</a>
      </div>
    </div>
  </header>

  <main id="content" class="container section">
    <!-- EXPLORE -->
    <section id="viewExplore" class="section">
      <div class="hero">
        <div>
          <h1>Discover my <span style="color:var(--accent)">best Custom GPTs</span></h1>
          <p>Keyboard‑driven. Beautifully organized. Only the good stuff — no random submissions.</p>

          <div class="quick" aria-hidden="true">
            <span class="k">⌘/Ctrl K: Command palette</span>
            <span class="k">/ : Focus search</span>
            <span class="k">Esc : Clear</span>
          </div>

          <div class="ribbon" style="margin-top:14px">
            <input id="q" class="input" type="search" placeholder="Search title, tags, categories…" aria-label="Search" />
            <select id="cat" class="input" aria-label="Category"></select>
            <select id="sort" class="input" aria-label="Sort">
              <option value="featured">Featured first</option>
              <option value="title">Title A→Z</option>
              <option value="recent">Recently added</option>
            </select>
            <button class="btn" id="reset">Reset</button>
          </div>

          <div class="langs" id="langs" aria-label="Language quick links"></div>
        </div>
        <div class="hero-card">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
            <strong>Highlights</strong>
            <span id="kpiCounts" style="color:var(--muted);font-size:12px"></span>
          </div>
          <div id="highlights" class="grid" style="grid-template-columns:repeat(12,1fr);gap:10px;margin-top:10px"></div>
        </div>
      </div>

      <div id="grid" class="grid" role="list" aria-label="Results"></div>
    </section>

    <!-- ADMIN -->
    <section id="viewAdmin" class="section hide">
      <div id="adminGate" class="panel">
        <h3 style="margin:0 0 8px">Owner sign‑in</h3>
        <div class="row">
          <input id="pin" type="password" placeholder="Enter owner PIN" class="input" />
          <button class="btn accent" id="pinGo">Enter</button>
        </div>
      </div>

      <div id="adminDesk" class="hide">
        <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:12px">
          <div class="col panel" style="grid-column:span 4"><h4 style="margin:.2rem 0">Live</h4><div id="kLive" style="font-weight:800;font-size:22px">0</div></div>
          <div class="col panel" style="grid-column:span 4"><h4 style="margin:.2rem 0">Featured</h4><div id="kFeat" style="font-weight:800;font-size:22px">0</div></div>
          <div class="col panel" style="grid-column:span 4"><h4 style="margin:.2rem 0">Hidden</h4><div id="kHidden" style="font-weight:800;font-size:22px">0</div></div>
        </div>

        <div class="section">
          <h3 style="margin:0 0 10px">All Items</h3>
          <div class="panel">
            <div class="row" style="margin-bottom:10px;flex-wrap:wrap">
              <input id="aQ" class="input" placeholder="Filter items…" />
              <select id="aStatus" class="input" style="max-width:200px"><option value="all">All</option><option value="live">Live</option><option value="hidden">Hidden</option></select>
              <button class="btn" id="aReset">Reset</button>
              <div style="margin-left:auto;display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn" id="exportBtn">Export JSON</button>
                <label class="btn" title="Import JSON"><input id="importFile" type="file" accept="application/json" style="display:none">Import</label>
                <button class="btn accent" id="addManual">＋ New</button>
              </div>
            </div>
            <div style="overflow:auto">
              <table>
                <thead><tr><th>Title</th><th>Cat/Tags</th><th>Featured</th><th>Status</th><th>Actions</th></tr></thead>
                <tbody id="tAll"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="section">
          <h3 style="margin:0 0 10px">Settings</h3>
          <div class="panel">
            <div class="row"><input id="siteTitle" class="input" placeholder="Site Title (public)"/></div>
            <div class="row"><input id="gaId" class="input" placeholder="Google Analytics ID (e.g., G-XXXX)"/></div>
            <div class="row" style="justify-content:flex-end"><button class="btn accent" id="saveSettings">Save Settings</button></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>© <span id="ftTitle">GPTMart</span> — curated Custom GPTs. No submissions.</footer>

  <!-- Command palette -->
  <div class="palette" id="palette" role="dialog" aria-modal="true" aria-labelledby="palLabel">
    <div class="pal-card">
      <div class="pal-head"><input id="palQ" placeholder="Type a command or search… (e.g., \"add\", \"export\", \"python\")" aria-label="Command"/></div>
      <div class="pal-list" id="palList" role="listbox" aria-labelledby="palLabel"></div>
    </div>
  </div>

  <!-- Add/Edit modal -->
  <dialog id="modal">
    <form method="dialog">
      <div class="panel" style="margin:0">
        <h3 id="mTitle">Add / Edit GPT</h3>
        <div class="row"><input id="mTitleIn" class="input" placeholder="Title" required></div>
        <div class="row"><input id="mUrlIn" class="input" placeholder="ChatGPT link (https://chatgpt.com/g/...)" required></div>
        <div class="row"><input id="mIconIn" class="input" placeholder="Icon URL"></div>
        <div class="row"><input id="mCatsIn" class="input" placeholder="Categories (comma-separated)"></div>
        <div class="row"><input id="mTagsIn" class="input" placeholder="Tags (comma-separated)"></div>
        <div class="row"><input id="mDescIn" class="input" placeholder="Short description"></div>
        <div class="row">
          <label style="display:flex;gap:8px;align-items:center"><input id="mFeatIn" type="checkbox">Featured</label>
          <select id="mStatusIn" class="input" style="max-width:200px"><option value="live">Live</option><option value="hidden">Hidden</option></select>
        </div>
        <div class="row" style="justify-content:flex-end;gap:8px">
          <button class="btn" value="cancel">Cancel</button>
          <button class="btn accent" id="mSave" value="default">Save</button>
        </div>
      </div>
    </form>
  </dialog>

  <script>
  /*************** CONSTANTS & STATE ***************/
  const LS_ITEMS    = 'gptmart.v6.items';
  const LS_SETTINGS = 'gptmart.v6.settings';
  const SESSION_ADMIN = 'gptmart.v6.isAdmin';
  const ADMIN_PIN = '4545'; // change this

  const state = { q:'', cat:'All', sort:'featured' };

  const contains = (t,q)=> (t||'').toLowerCase().includes((q||'').toLowerCase());
  const $  = (s,el=document)=> el.querySelector(s);
  const $$ = (s,el=document)=> Array.from(el.querySelectorAll(s));
  const uniq = arr => Array.from(new Set(arr));
  const toCSV = a => (a||[]).join(', ');
  const fromCSV = s => (s||'').split(',').map(x=>x.trim()).filter(Boolean);

  function read(k,def){ try{ return JSON.parse(localStorage.getItem(k) || JSON.stringify(def)); }catch(e){ return def; } }
  function write(k,v){ localStorage.setItem(k, JSON.stringify(v)); }

  /*************** DATA ***************/
  // Language shortcuts — keep small & meaningful (customize freely)
  const LANGUAGES = [
    { name: "Python", icon: "https://upload.wikimedia.org/wikipedia/commons/c/c3/Python-logo-notext.svg", url: "https://chatgpt.com/g/g-67ef5a74409081919143341dc018e522-python?model=gpt-5" },
    { name: "JavaScript", icon: "https://upload.wikimedia.org/wikipedia/commons/9/99/Unofficial_JavaScript_logo_2.svg", url: "https://chatgpt.com/g/g-67ef55adf8bc8191b0ed342c54a7ffed-javascript" },
    { name: "TypeScript", icon: "https://upload.wikimedia.org/wikipedia/commons/4/4c/Typescript_logo_2020.svg", url: "https://chatgpt.com/g/g-67efb97be07c8191b266b92f5e095c99-typescript" },
    { name: "Go", icon: "https://upload.wikimedia.org/wikipedia/commons/0/05/Go_Logo_Blue.svg", url: "https://chatgpt.com/g/g-67ef61ba9f588191bf95969b202cbb40-go-golang" },
    { name: "R", icon: "https://upload.wikimedia.org/wikipedia/commons/1/1b/R_logo.svg", url: "https://chatgpt.com/g/g-67ef6038ca98819185f6220127732863-r" }
  ];

  // Seeded items. If you previously exported v5 JSON, importing will preserve your full catalog.
  const STARTER_GPTS = [
    { title:"Artificial Intelligence Mentor", desc:"ML, DL, NLP, CV, RL, Generative AI. Runnable code & projects.", icon:"https://upload.wikimedia.org/wikipedia/commons/b/b9/AI_logo_by_United_Blasters.png", categories:["AI & Automation","Data"], tags:["ai","ml"], url:"https://chatgpt.com/g/g-68b6e97f95ac81918b262e088c05f522-artificial-intelligence-mentor", featured:true },
    { title:"Data Science Mentor", desc:"NumPy, Pandas, scikit-learn, plots. Beginner→advanced.", icon:"https://cdn-icons-png.flaticon.com/512/2967/2967262.png", categories:["Data","AI & Automation"], tags:["pandas","numpy"], url:"https://chatgpt.com/g/g-68b6a06e44e881919c09ff648d64b0f3-data-science-mentor", featured:true },
    { title:"Responsive UI Coach (Bootstrap)", desc:"Accessible components, v3/v4→v5 upgrades, utilities.", icon:"https://cdn.iconscout.com/icon/free/png-256/bootstrap-226077.png", categories:["Frontend","Design"], tags:["bootstrap","css"], url:"https://chatgpt.com/g/g-68b697b5913c81918e64a23a52138255-responsive-ui-coach-bootstrap-ready" },
    { title:"Spam & Scam Detector", desc:"Detect phishing/spam in email/SMS/DMs.", icon:"https://cdn-icons-png.flaticon.com/512/2926/2926715.png", categories:["Security","Tools"], tags:["security"], url:"https://chatgpt.com/g/g-686522599f78819196f796d8f20dc5a7-spam-scam-detector-protect-your-inbox?model=gpt-4o" }
  ];

  function initData(){
    let have = read(LS_ITEMS, []);
    if(!have || !have.length){
      have = STARTER_GPTS.map((x,idx)=>({ ...x, status:'live', createdAt: Date.now() - (STARTER_GPTS.length-idx)*3600_000 }));
      if(!have.some(x=>x.featured)) have.slice(0,4).forEach(x=> x.featured = true);
      write(LS_ITEMS, have);
    }else{
      have = have.map((x,i)=> x.createdAt ? x : ({...x, createdAt: Date.now()-i*3600_000}));
      write(LS_ITEMS, have);
    }
    if(!read(LS_SETTINGS, null)) write(LS_SETTINGS, { title:'GPTMart', ga: window.GA_MEASUREMENT_ID });
  }

  function items(){ return read(LS_ITEMS, []); }
  function setItems(v){ write(LS_ITEMS, v); renderAll(); }
  function settings(){ return read(LS_SETTINGS, {title:'GPTMart', ga:window.GA_MEASUREMENT_ID}); }
  function setSettings(v){ write(LS_SETTINGS, v); applySettings(); }

  /*************** RENDER (EXPLORE) ***************/
  const grid = $('#grid');
  const qInput = $('#q');
  const catSelect = $('#cat');
  const sortSelect = $('#sort');

  function renderLanguages(){ $('#langs').innerHTML = LANGUAGES.map(l=>`<a class="lang" href="${l.url}" target="_blank" rel="noopener"><img loading="lazy" src="${l.icon}" alt="${l.name}"><span>${l.name}</span></a>`).join(''); }

  function renderCategories(){
    const cats = uniq(items().flatMap(x=>x.categories||[])).sort();
    catSelect.innerHTML = '<option value="All">All categories</option>' + cats.map(c=>`<option ${state.cat===c?'selected':''}>${c}</option>`).join('');
  }

  function cardTemplate(x){
    const tags = (x.tags||[]).map(t=>`<span class="tag">#${t}</span>`).join('');
    return `<article class="card col" role="listitem" aria-label="${x.title}">
      <div class="badge">${x.featured? 'Featured' : x.status==='hidden'?'Hidden':'Live'}</div>
      <div class="icon"><img loading="lazy" src="${x.icon||'https://cdn-icons-png.flaticon.com/512/4712/4712151.png'}" alt="${x.title} icon"/></div>
      <h3 class="title">${x.title||'Untitled GPT'}</h3>
      <p class="desc">${x.desc||''}</p>
      <div class="tags">${tags}</div>
      <div class="actions">
        <a class="btn accent" href="${x.url}" target="_blank" rel="noopener" aria-label="Open ${x.title}">Open</a>
        <button class="btn" data-share='${encodeURIComponent(JSON.stringify({title:x.title,url:x.url}))}'>Share</button>
      </div>
    </article>`;
  }

  function sortList(list){
    if(state.sort==='title') return list.slice().sort((a,b)=> (a.title||'').localeCompare(b.title||''));
    if(state.sort==='recent') return list.slice().sort((a,b)=> (b.createdAt||0)-(a.createdAt||0));
    return list.slice().sort((a,b)=>{ const af=a.featured?1:0, bf=b.featured?1:0; if(bf!==af) return bf-af; return (a.title||'').localeCompare(b.title||''); });
  }

  function renderGrid(){
    const list = items().filter(x=> x.status==='live');
    const q = (state.q||'').trim();
    const filtered = list.filter(x=>{
      const inQ = !q || [x.title,x.desc,toCSV(x.tags),toCSV(x.categories)].some(v=>contains(v,q));
      const inCat = state.cat==='All' || (x.categories||[]).includes(state.cat);
      return inQ && inCat;
    });
    const ordered = sortList(filtered);
    grid.innerHTML = ordered.map(cardTemplate).join('');
    wireShare();
  }

  function renderHighlights(){
    const feats = items().filter(x=>x.status==='live' && x.featured).slice(0,6);
    const wrap = $('#highlights');
    wrap.innerHTML = feats.map(x=>`<a class="chip" href="${x.url}" target="_blank" rel="noopener" title="${x.title}">${x.title}</a>`).join('');
  }

  function wireShare(){
    $$('#grid [data-share]').forEach(btn=> btn.onclick = async ()=>{
      const payload = JSON.parse(decodeURIComponent(btn.dataset.share));
      const text = `${payload.title} — ${payload.url}`;
      if(navigator.share){ try{ await navigator.share({ title: payload.title, url: payload.url, text }); }catch(e){} }
      else { await navigator.clipboard.writeText(text); alert('Link copied!'); }
    });
  }

  /*************** ADMIN ***************/
  const adminGate = $('#adminGate');
  const adminDesk = $('#adminDesk');

  function isAdmin(){ return sessionStorage.getItem(SESSION_ADMIN)==='1'; }
  function requireAdmin(){ if(isAdmin()){ adminGate.classList.add('hide'); adminDesk.classList.remove('hide'); renderAdmin(); } else { adminGate.classList.remove('hide'); adminDesk.classList.add('hide'); } }

  $('#pinGo').addEventListener('click', ()=>{ const entered = ($('#pin').value||'').trim(); if(entered===ADMIN_PIN){ sessionStorage.setItem(SESSION_ADMIN,'1'); requireAdmin(); } else alert('Access denied'); });

  function renderAdmin(){
    const it = items();
    $('#kLive').textContent   = it.filter(x=>x.status==='live').length;
    $('#kHidden').textContent = it.filter(x=>x.status==='hidden').length;
    $('#kFeat').textContent   = it.filter(x=>x.featured && x.status==='live').length;

    const q = ($('#aQ').value||'').trim();
    const st = $('#aStatus').value||'all';
    const filtered = it.filter(x=>{ const inQ = !q || [x.title,x.desc,toCSV(x.tags),toCSV(x.categories)].some(v=>contains(v,q)); const inS = st==='all' || x.status===st; return inQ && inS; });

    $('#tAll').innerHTML = filtered.map((x)=>{
      const i = it.indexOf(x);
      return `<tr>
        <td>${x.title}</td>
        <td><small>${toCSV(x.categories)}</small><br><small style="color:#93c5fd">${toCSV(x.tags)}</small></td>
        <td>${x.featured? '⭐️' : '—'}</td>
        <td>${x.status}</td>
        <td>
          <button class="btn" data-edit="${i}">Edit</button>
          <button class="btn" data-togglef="${i}">${x.featured?'Unfeature':'Feature'}</button>
          <button class="btn" data-toggleh="${i}">${x.status==='hidden'?'Unhide':'Hide'}</button>
          <a class="btn accent" href="${x.url}" target="_blank">Open</a>
          <button class="btn" data-del="${i}" style="border-color:#2b2b2b">Delete</button>
        </td>
      </tr>`;
    }).join('');

    $$('#tAll [data-edit]').forEach(b=> b.addEventListener('click', ()=> openModal(+b.dataset.edit)));
    $$('#tAll [data-togglef]').forEach(b=> b.addEventListener('click', ()=>{ const itms = items(); const i=+b.dataset.togglef; itms[i].featured=!itms[i].featured; setItems(itms);}));
    $$('#tAll [data-toggleh]').forEach(b=> b.addEventListener('click', ()=>{ const itms = items(); const i=+b.dataset.toggleh; itms[i].status = itms[i].status==='hidden'?'live':'hidden'; setItems(itms);}));
    $$('#tAll [data-del]').forEach(b=> b.addEventListener('click', ()=>{ const itms=items(); itms.splice(+b.dataset.del,1); setItems(itms);}));
  }

  // Filters (admin)
  $('#aQ').addEventListener('input', renderAdmin);
  $('#aStatus').addEventListener('change', renderAdmin);
  $('#aReset').addEventListener('click', ()=>{ $('#aQ').value=''; $('#aStatus').value='all'; renderAdmin(); });

  // Export / Import
  $('#exportBtn').addEventListener('click', ()=>{
    const data = { items: items(), settings: settings() };
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'gptmart-export.json'; a.click();
  });
  $('#importFile').addEventListener('change', (e)=>{
    const file = e.target.files[0]; if(!file) return;
    const reader = new FileReader(); reader.onload = ()=>{
      try{
        const data = JSON.parse(reader.result);
        if(Array.isArray(data.items)) write(LS_ITEMS, data.items);
        if(data.settings){ const curr = settings(); write(LS_SETTINGS, { title: data.settings.title || curr.title, ga: data.settings.ga || curr.ga }); }
        renderAll(); alert('Imported!');
      }catch(err){ alert('Invalid file'); }
    };
    reader.readAsText(file);
  });

  // Settings
  $('#saveSettings').addEventListener('click', ()=>{
    const s = settings();
    s.title = $('#siteTitle').value.trim() || s.title;
    s.ga = $('#gaId').value.trim() || s.ga;
    setSettings(s);
    alert('Settings saved');
  });

  // Modal
  $('#addManual').addEventListener('click', ()=> openModal());
  function openModal(editIndex){
    const itms = items();
    const editing = typeof editIndex==='number'? itms[editIndex] : null;
    $('#mTitle').textContent = editing? 'Edit GPT' : 'Add GPT';
    $('#mTitleIn').value = editing?.title || '';
    $('#mUrlIn').value = editing?.url || '';
    $('#mIconIn').value = editing?.icon || '';
    $('#mDescIn').value = editing?.desc || '';
    $('#mCatsIn').value = toCSV(editing?.categories);
    $('#mTagsIn').value = toCSV(editing?.tags);
    $('#mFeatIn').checked = !!editing?.featured;
    $('#mStatusIn').value = editing?.status || 'live';
    $('#modal').showModal();
    $('#mSave').onclick = ()=>{
      const item = {
        title: $('#mTitleIn').value.trim(),
        url: $('#mUrlIn').value.trim(),
        icon: $('#mIconIn').value.trim(),
        desc: $('#mDescIn').value.trim(),
        categories: fromCSV($('#mCatsIn').value),
        tags: fromCSV($('#mTagsIn').value),
        featured: $('#mFeatIn').checked,
        status: $('#mStatusIn').value,
        createdAt: editing?.createdAt || Date.now()
      };
      if(!item.title || !item.url){ alert('Title and URL required.'); return; }
      if(editing){ itms[editIndex] = item; setItems(itms); }
      else { itms.push(item); setItems(itms); }
      $('#modal').close();
    };
  }

  /*************** COMMAND PALETTE ***************/
  const palette = $('#palette');
  const palQ = $('#palQ');
  const palList = $('#palList');
  $('#openPalette').addEventListener('click', openPalette);
  document.addEventListener('keydown', (e)=>{
    const k = e.key.toLowerCase();
    const ctrl = e.ctrlKey || e.metaKey;
    if((ctrl && k==='k')){ e.preventDefault(); openPalette(); }
    if(k==='/' && document.activeElement!==qInput){ e.preventDefault(); qInput.focus(); }
    if(k==='escape') closePalette();
  }, true);

  function openPalette(){ palette.classList.add('open'); palQ.value=''; renderPalette(''); palQ.focus(); }
  function closePalette(){ palette.classList.remove('open'); }

  function paletteActions(){
    return [
      { label:'Add new GPT', fn: ()=>openModal(), hint:'Create an entry' },
      { label:'Export JSON', fn: ()=>$('#exportBtn').click(), hint:'Backup data' },
      { label:'Import JSON', fn: ()=>$('#importFile').click(), hint:'Restore data' },
      { label:'Go to Explore', fn: ()=>navigate('#/explore'), hint:'View mode' },
      { label:'Go to Admin', fn: ()=>navigate('#/admin'), hint:'Owner dashboard' },
      { label:'Toggle Featured on first item', fn: ()=>{ const itms=items(); if(itms[0]){ itms[0].featured=!itms[0].featured; setItems(itms);} }, hint:'Demo' },
      { label:'Clear search', fn: ()=>{ state.q=''; qInput.value=''; renderGrid(); }, hint:'Reset query' },
      { label:'Focus search', fn: ()=>{ qInput.focus(); }, hint:'Shortcut: /' },
      { label:'About', fn: ()=> alert('GPTMart — keyboard‑first directory. Built as a single HTML file.'), hint:'Info' },
    ].concat(items().slice(0,20).map(x=>({ label:`Open: ${x.title}`, fn: ()=>window.open(x.url,'_blank'), hint:x.categories?.join(', ')||'' })));
  }

  function renderPalette(q){
    const acts = paletteActions().filter(a=> contains(a.label,q) || contains(a.hint,q));
    palList.innerHTML = acts.map((a,i)=>`<div class="pal-item" role="option" data-i="${i}"><div>${a.label}</div><small style="color:var(--muted)">${a.hint||''}</small></div>`).join('');
    $$('#palList .pal-item').forEach(el=> el.onclick = ()=>{ const i=+el.dataset.i; acts[i].fn?.(); closePalette(); });
  }
  palQ.addEventListener('input', e=> renderPalette(e.target.value));
  palette.addEventListener('click', (e)=>{ if(e.target===palette) closePalette(); });

  /*************** ROUTING & SETTINGS ***************/
  function applySettings(){
    const s = settings();
    $('#ftTitle').textContent = s.title || 'GPTMart';
    $('#siteLogo').textContent = s.title || 'GPTMart';
    document.title = (s.title||'GPTMart') + ' — Curated Custom GPTs';
    window.GA_MEASUREMENT_ID = s.ga || window.GA_MEASUREMENT_ID;
    $('#siteTitle').value = s.title||'';
    $('#gaId').value = s.ga||'';
  }

  function navigate(hash){ location.hash = hash; onRoute(); }
  function onRoute(){ const h=(location.hash||'#/explore');
    $$('#top .chip').forEach(c=>c.classList.remove('active'));
    if(h.startsWith('#/admin')){ showTab('admin'); } else { showTab('explore'); }
  }

  function showTab(which){
    $$('#navExplore, #navAdmin').forEach(x=>x.classList.remove('active'));
    if(which==='admin'){ $('#navAdmin').classList.add('active'); $('#viewAdmin').classList.remove('hide'); $('#viewExplore').classList.add('hide'); requireAdmin(); }
    else { $('#navExplore').classList.add('active'); $('#viewAdmin').classList.add('hide'); $('#viewExplore').classList.remove('hide'); }
  }

  /*************** WIRING ***************/
  qInput.addEventListener('input', e=>{ state.q = e.target.value; renderGrid(); });
  $('#reset').addEventListener('click', ()=>{ state.q=''; qInput.value=''; state.cat='All'; catSelect.value='All'; sortSelect.value='featured'; state.sort='featured'; renderGrid();});
  catSelect.addEventListener('change', e=>{ state.cat = e.target.value; renderGrid(); });
  sortSelect.addEventListener('change', e=>{ state.sort = e.target.value; renderGrid(); });

  function syncPublic(){ renderCategories(); renderGrid(); renderHighlights(); $('#kpiCounts').textContent = `${items().filter(x=>x.status==='live').length} live • ${items().filter(x=>x.featured).length} featured`; }
  function renderAll(){ syncPublic(); if(isAdmin()) renderAdmin(); }

  // Init
  initData();
  renderLanguages();
  applySettings();
  renderAll();
  onRoute();

  window.addEventListener('hashchange', onRoute);

  // Light anti‑inspect (optional — keeps UX smooth)
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('keydown', e => {
    const k = e.key.toLowerCase(); const ctrl = e.ctrlKey || e.metaKey;
    if ((ctrl && ['u','s','p'].includes(k)) || k==='f12' || (ctrl && e.shiftKey && ['i','c','j'].includes(k))) {
      e.preventDefault(); e.stopPropagation();
    }
  }, true);
  </script>
</body>
</html>
